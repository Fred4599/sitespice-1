---
import Layout from './Layout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import ServiceTestimonials from '../components/ServiceTestimonials.astro';

export interface Feature {
  icon: string;
  title: string;
  description: string;
  items: string[];
}

export interface ProcessStep {
  number: string;
  title: string;
  description: string;
}

export interface Props {
  title: string;
  description: string;
  serviceNumber: string;
  icon: string;
  heroTitle: string;
  heroSubtitle: string;
  taglineLabel?: string;
  taglineTitle: string;
  taglineHighlight: string;
  taglineEnd: string;
  features: Feature[];
  philosophyIcon?: string;
  philosophyTitle: string;
  philosophyContent: string[];
  processTitle?: string;
  processSubtitle?: string;
  processSteps?: ProcessStep[];
  highlightTitle: string;
  highlightContent: string;
  highlightTagline?: string;
  ctaTitle: string;
  ctaSubtitle: string;
  ctaButtonText?: string;
}

const {
  title,
  description,
  serviceNumber,
  icon,
  heroTitle,
  heroSubtitle,
  taglineLabel = "What We Deliver",
  taglineTitle,
  taglineHighlight,
  taglineEnd,
  features,
  philosophyIcon = "ph:lightbulb-light",
  philosophyTitle,
  philosophyContent,
  processTitle,
  processSubtitle,
  processSteps,
  highlightTitle,
  highlightContent,
  highlightTagline,
  ctaTitle,
  ctaSubtitle,
  ctaButtonText = "Get Started"
} = Astro.props;
---

<Layout title={title} description={description}>
  <!-- Hero Video Background -->
  <div class="fixed inset-0 -z-30 w-full h-full overflow-hidden pointer-events-none">
    <video 
      id="service-hero-video"
      autoplay 
      loop 
      muted 
      playsinline 
      preload="none"
      class="w-full h-full object-cover opacity-20 mix-blend-screen" 
      style="filter: hue-rotate(150deg) contrast(1.2);">
      <source src="https://cdn.coverr.co/videos/coverr-digital-lines-moving-background-4770/1080p.mp4" type="video/mp4">
    </video>
    <div class="absolute inset-0 bg-gradient-to-b from-black via-black/80 to-black"></div>
  </div>

  <!-- Background Gradient -->
  <div class="fixed inset-0 -z-20 bg-gradient-to-b from-purple-900/5 via-black to-black pointer-events-none"></div>

  <!-- Technical Grid Overlay -->
  <div class="fixed inset-0 pointer-events-none z-0 technical-grid opacity-30"></div>

  <!-- Vertical Structure Lines -->
  <div class="fixed inset-0 pointer-events-none z-0 max-w-[1400px] mx-auto border-x border-white/[0.04]">
    <div class="absolute left-1/4 h-full w-px bg-white/[0.02]"></div>
    <div class="absolute left-2/4 h-full w-px bg-white/[0.02]"></div>
    <div class="absolute left-3/4 h-full w-px bg-white/[0.02]"></div>
  </div>

  <Navigation />

  <main class="z-10 relative">
    <!-- Hero Section -->
    <section class="pt-32 pb-20 px-6">
      <div class="max-w-[1400px] mx-auto">
        <div class="mb-16 animate-on-scroll" style="animation: animationIn 0.8s ease-out forwards;">
          <div class="inline-flex items-center gap-2 px-4 py-2 mb-6 border border-white/10 rounded-full bg-white/5">
            <iconify-icon icon={icon} class="text-purple-400"></iconify-icon>
            <span class="text-[10px] font-mono text-purple-300 uppercase tracking-widest">
              Service {serviceNumber}
            </span>
          </div>
          <h1 class="text-6xl md:text-8xl font-bold mb-8 bg-gradient-to-r from-white via-purple-200 to-white bg-clip-text text-transparent leading-[0.9]" set:html={heroTitle}></h1>
          <p class="text-neutral-300 text-xl md:text-2xl max-w-3xl leading-relaxed">
            {heroSubtitle}
          </p>
        </div>
      </div>
    </section>

    <!-- What We Deliver Section -->
    <section class="py-20 px-6">
      <div class="max-w-[1400px] mx-auto">
        <div class="mb-16">
          <div class="text-[10px] font-mono text-neutral-500 uppercase mb-4">
            {taglineLabel}
          </div>
          <h2 class="text-4xl md:text-5xl font-medium tracking-tight text-white max-w-2xl leading-[1.05]">
            {taglineTitle}
            <br>
            <span class="text-neutral-600">{taglineHighlight}</span>
            {taglineEnd}
          </h2>
        </div>

        <div class="grid md:grid-cols-3 gap-px bg-white/10 border border-white/10 overflow-hidden spotlight-grid">
          {features.map((feature, index) => (
            <div class="group bg-black p-10 hover:bg-neutral-900/40 transition-colors relative spotlight-card animate-on-scroll" style={`animation: animationIn 0.8s ease-out ${0.2 + index * 0.1}s forwards; animation-play-state: paused;`}>
              <div class="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-purple-500/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
              <div class="relative z-10">
                <div class="mb-8 text-neutral-700 group-hover:text-purple-400 transition-colors">
                  <iconify-icon icon={feature.icon} width="48"></iconify-icon>
                </div>
                <h3 class="text-2xl font-medium text-white mb-4">{feature.title}</h3>
                <p class="text-neutral-400 mb-6 leading-relaxed">
                  {feature.description}
                </p>
                <ul class="space-y-3 text-sm text-neutral-500">
                  {feature.items.map((item) => (
                    <li class="flex items-center gap-3">
                      <div class="w-1.5 h-1.5 rounded-full bg-purple-500"></div>
                      {item}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Philosophy/Approach Section -->
    <section class="py-20 px-6 border-t border-white/5">
      <div class="max-w-[900px] mx-auto">
        <div class="backdrop-blur-xl bg-white/[0.02] border border-white/[0.08] rounded-3xl p-12 md:p-16 animate-on-scroll" style="animation: animationIn 0.8s ease-out 0.5s forwards; animation-play-state: paused;">
          <div class="flex items-center gap-3 mb-8">
            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center">
              <iconify-icon icon={philosophyIcon} class="text-2xl text-white"></iconify-icon>
            </div>
            <h2 class="text-3xl md:text-4xl font-bold">{philosophyTitle}</h2>
          </div>
          
          <div class="space-y-6 text-neutral-300 leading-relaxed text-lg">
            {philosophyContent.map((paragraph) => (
              <p set:html={paragraph}></p>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Process Steps Section (Optional) -->
    {processSteps && processSteps.length > 0 && (
      <section class="py-20 px-6">
        <div class="max-w-[1200px] mx-auto">
          {(processTitle || processSubtitle) && (
            <div class="text-center mb-16 animate-on-scroll" style="animation: animationIn 0.8s ease-out 0.6s forwards; animation-play-state: paused;">
              {processTitle && <h2 class="text-4xl md:text-5xl font-bold mb-4">{processTitle}</h2>}
              {processSubtitle && <p class="text-neutral-400 text-lg">{processSubtitle}</p>}
            </div>
          )}

          <div class={`grid gap-8 ${processSteps.length === 4 ? 'md:grid-cols-4' : 'md:grid-cols-2'}`}>
            {processSteps.map((step, index) => (
              <div class="backdrop-blur-xl bg-white/[0.02] border border-white/[0.08] rounded-2xl p-8 animate-on-scroll" style={`animation: animationIn 0.8s ease-out ${0.7 + index * 0.1}s forwards; animation-play-state: paused;`}>
                <div class="text-6xl font-bold text-purple-500/20 mb-4">{step.number}</div>
                <h3 class="text-xl font-semibold mb-3">{step.title}</h3>
                <p class="text-neutral-400 text-sm leading-relaxed">
                  {step.description}
                </p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Testimonials Section -->
    <ServiceTestimonials />

    <!-- Highlight CTA Section -->
    <section class="py-20 px-6">
      <div class="max-w-[900px] mx-auto">
        <div class="backdrop-blur-xl bg-gradient-to-br from-purple-500/10 to-purple-700/5 border border-purple-500/20 rounded-3xl p-12 md:p-16 text-center animate-on-scroll" style="animation: animationIn 0.8s ease-out 1s forwards; animation-play-state: paused;">
          <h2 class="text-4xl font-bold mb-6">{highlightTitle}</h2>
          <p class="text-neutral-300 text-lg mb-8 leading-relaxed max-w-2xl mx-auto" set:html={highlightContent}></p>
          {highlightTagline && (
            <div class="inline-flex items-center gap-3 text-purple-300">
              <iconify-icon icon="ph:check-circle" width="24"></iconify-icon>
              <span class="font-semibold">{highlightTagline}</span>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Final CTA Section -->
    <section class="py-32 px-6">
      <div class="max-w-[900px] mx-auto text-center animate-on-scroll" style="animation: animationIn 0.8s ease-out 1.1s forwards; animation-play-state: paused;">
        <h2 class="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-white via-purple-200 to-white bg-clip-text text-transparent">
          {ctaTitle}
        </h2>
        <p class="text-neutral-300 text-xl mb-12 leading-relaxed">
          {ctaSubtitle}
        </p>
        <a 
          href="/contact" 
          class="shiny-cta inline-block magnetic-btn"
        >
          {ctaButtonText}
        </a>
      </div>
    </section>

    <Footer />
  </main>
</Layout>

<script>
  // Lazy load video only when visible
  if ('IntersectionObserver' in window) {
    const videoObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const video = entry.target as HTMLVideoElement;
          video.preload = 'auto';
          video.load();
          videoObserver.unobserve(video);
        }
      });
    }, { rootMargin: '100px' });
    
    const serviceVideo = document.getElementById('service-hero-video');
    if (serviceVideo) {
      videoObserver.observe(serviceVideo);
    }
  }
</script>
